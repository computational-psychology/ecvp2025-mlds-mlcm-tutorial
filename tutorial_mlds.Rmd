---
title: "MLDS tutorial"
author: "Guillermo Aguilar"
date: "2025-08-06"
output:
  html_notebook: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(MLDS)
```

## Analysis of an MLDS experiment

Text here explaning

### 1. Loading and parsing data

```{r}
fname1 <- 'experiment/data/GA3.csv'
fname2 <- 'experiment/data/GA4.csv'
fname3 <- 'experiment/data/GA5.csv'
fname4 <- 'experiment/data/GA6.csv'

df1 <- read.csv(fname1)
df1
```
We keep only the relevant columns
```{r}
df1 <- df1[c('resp.keys', 's1', 's2', 's3')]
df1
```

More data files can be read and we just concatenate them

```{r}
df2 <- read.csv(fname2)
df2 <- df2[c('resp.keys', 's1', 's2', 's3')]

df3 <- read.csv(fname3)
df3 <- df3[c('resp.keys', 's1', 's2', 's3')]

df4 <- read.csv(fname4)
df4 <- df2[c('resp.keys', 's1', 's2', 's3')]

df <- rbind(df1, df2, df3, df4)
df
```
```{r}
df4
```
### Parse data to MLDS format

We need to map the key presse to 0 or 1
```{r}
df$resp <- as.numeric(df$resp.keys == 'left')
df
```


```{r}
stim_vector <- c(5, 10, 15, 20, 25, 30, 40, 50, 60)
stim_index <- seq(length(stim_vector))


for (i in 1:length(stim_vector)) {
  df$s1 <- replace(df$s1, df$s1==stim_vector[i], stim_index[i])
  df$s2 <- replace(df$s2, df$s2==stim_vector[i], stim_index[i])
  df$s3 <- replace(df$s3, df$s3==stim_vector[i], stim_index[i])
}


data <- df[c('resp', 's1', 's2', 's3')]
colnames(data) <- c("Resp", "S1", "S2", "S3")


data
```

### 2. Estimating perceptual scale 

Here we use the functions from the MLDS package.


```{r}
data <- as.mlbs.df(data, stim_vector)
```

```{r}
scale <- mlds(data)
scale
```

```{r}
par(pty="s")
plot(scale, xlab = "Number of dots", ylab = "Perceived numerosity")
lines(c(min(scale$stimulus), max(scale$stimulus)), c(0, max(scale$pscale)), type = "l", lty = 1)
```
### 3. Confidence intervals and goodness of fit

Both procedures rely on bootstrap techniques, where the observer model in MLDS is used to simulate 
synthetic data, which is fed back into the MLDS estimation routine.


#### Confidence intervals

```{r  warning=FALSE}
scale.boot <- boot.mlds(scale, nsim=1000)
scale.bt.res <- summary(scale.boot)

```

```{r}
scale.bt.mns <- scale.bt.res[, 1] # bootstrap mean
scale.bt.95ci <- qnorm(0.975) * scale.bt.res[, 2] # 95 CI

par(pty="s")
plot(scale, xlab = "Number of dots", ylab = "Perceived numerosity", standard.scale = TRUE)
segments(scale$stimulus, scale.bt.mns + scale.bt.95ci, 
         scale$stimulus, scale.bt.mns - scale.bt.95ci, )
lines(c(min(scale$stimulus), max(scale$stimulus)), c(0, 1), type = "l", lty = 1)

```



#### Goodness of fit evaluation


```{r  warning=FALSE}
scale.gof <- binom.diagnostics(scale)
```

```{r  warning=FALSE}
plot(scale.gof)
```
